<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数学オンライン（仮）</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'M PLUS Rounded 1c', sans-serif; }
        .hidden-screen { display: none !important; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #d1d5db; }
        
        .answer-dock { box-shadow: 0 -4px 20px rgba(0,0,0,0.05); }

        .reveal-row { transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .reveal-row.active { 
            transform: scale(1.02); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            background-color: #fff; 
            z-index: 50;
            border-color: transparent; 
        }
        
        .bg-correct { background-color: #10B981 !important; } 
        .bg-wrong { background-color: #9CA3AF !important; }

        .review-mode .input-area { display: none; }
        .review-mode .review-controls { display: flex !important; }

        .math-input-container { position: relative; }
        .math-input-real {
            color: transparent; 
            caret-color: #2563EB; 
            background: transparent;
            z-index: 10;
            position: relative;
        }
        .math-input-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            display: flex;
            align-items: center;
            padding-left: 1rem; 
            z-index: 5;
            color: #374151;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 h-screen w-screen overflow-hidden">

    <div id="loading-overlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center hidden-screen">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
    </div>

    <section id="screen-login" class="h-full flex flex-col justify-center items-center p-6">
        <div class="bg-white p-10 rounded-2xl shadow-sm max-w-md w-full border border-gray-100">
            <h1 class="text-3xl font-bold text-center mb-2 tracking-tight">数学オンライン（仮）</h1>
            <p class="text-gray-400 text-center mb-8 text-sm">Mathematics Competitive Platform</p>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold text-gray-600 mb-1">ユーザー名</label>
                    <input type="text" id="input-username" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition" placeholder="例: Euler">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-600 mb-1">パスコード</label>
                    <input type="password" id="input-passcode" class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition" placeholder="4桁以上の数字">
                </div>
                <button id="btn-login" class="w-full bg-gray-900 hover:bg-black text-white font-bold py-3 rounded-lg transition transform active:scale-95 shadow-lg mt-4">
                    LOGIN
                </button>
            </div>
            <div class="mt-6 text-center text-xs text-gray-300">
                管理者: admin / 098545
            </div>
        </div>
    </section>

    <section id="screen-lobby" class="hidden-screen h-full flex flex-col p-6 max-w-5xl mx-auto">
        <header class="flex justify-between items-center mb-6">
            <div>
                <h2 class="text-2xl font-bold" id="lobby-username">Loading...</h2>
                <div class="flex items-center space-x-2 text-sm text-gray-500">
                    <span class="bg-gray-200 px-2 py-0.5 rounded text-xs font-bold">レート</span>
                    <span class="font-mono text-lg text-blue-600 font-bold" id="lobby-rate">----</span>
                </div>
            </div>
            <button onclick="location.reload()" class="text-sm text-gray-400 hover:text-gray-600 font-bold">Logout</button>
        </header>

        <div class="flex-1 overflow-y-auto pr-2 pb-10">
            <div class="mb-8">
                <h3 class="text-sm font-bold text-blue-600 mb-4 tracking-widest flex items-center sticky top-0 bg-gray-100 py-2 z-10">
                    <span class="w-2 h-2 rounded-full bg-blue-600 mr-2 animate-pulse"></span>
                    募集中
                </h3>
                <div id="event-list-active" class="space-y-3"></div>
            </div>

            <div>
                <h3 class="text-sm font-bold text-gray-400 mb-4 tracking-widest border-t border-gray-200 pt-8 sticky top-0 bg-gray-100 py-2 z-10">終了</h3>
                <div id="event-list-archive" class="space-y-3"></div>
                <button id="btn-show-more-archive" class="hidden w-full text-center text-xs text-gray-400 py-3 hover:text-gray-600">
                    + Show All Archives
                </button>
            </div>
        </div>
    </section>

    <section id="screen-waiting" class="hidden-screen h-full flex flex-col justify-center items-center bg-white text-gray-800 relative">
        <div class="text-center">
            <p class="text-blue-600 font-bold tracking-widest text-sm mb-4">待機中</p>
            <div class="text-8xl font-mono font-bold mb-8 tracking-tighter text-gray-900" id="countdown">--:--</div>
            <p class="text-gray-400 text-sm animate-pulse">開始までお待ちください</p>
        </div>
        <button onclick="backToLobby()" class="absolute bottom-10 text-xs text-gray-300 hover:text-gray-500 transition">
            ロビーへ戻る
        </button>
    </section>

    <section id="screen-answer" class="hidden-screen h-full flex flex-col bg-gray-50">
        <div class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center shadow-sm z-20">
            <div class="flex items-center space-x-4">
                <span class="bg-gray-900 text-white px-3 py-1 rounded text-sm font-bold tracking-wider">Q.<span id="display-q-num">1</span></span>
                <span class="text-xs font-mono text-red-500 font-bold" id="answer-timer-display">--:--</span>
                <button id="btn-back-lobby-review" class="hidden text-xs bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded font-bold text-gray-600">ロビーへ戻る</button>
            </div>
            <div class="flex space-x-2" id="nav-bubbles"></div>
        </div>

        <div class="flex-1 overflow-y-auto p-4 md:p-8 flex justify-center items-start">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 md:p-12 max-w-4xl w-full mt-4 mb-32 relative">
                <div id="review-badge" class="hidden absolute top-4 right-4 bg-gray-100 text-gray-500 text-xs font-bold px-2 py-1 rounded">ARCHIVE VIEW</div>
                <div class="text-xl md:text-3xl leading-relaxed font-medium text-gray-800 overflow-x-auto break-words" id="problem-text"></div>
                <div class="mt-8 pt-8 border-t border-gray-100 text-sm text-gray-400" id="problem-rule"></div>
            </div>
        </div>

        <div class="answer-dock bg-white border-t border-gray-200 p-4 md:p-6 z-30 w-full absolute bottom-0">
            <div class="max-w-4xl mx-auto flex flex-col gap-4">
                <div class="relative input-area">
                    <div class="flex gap-2 items-center">
                        <div class="flex-1 math-input-container relative bg-gray-50 border border-gray-300 rounded-lg focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-transparent transition">
                            <div id="math-overlay" class="math-input-overlay text-lg font-mono"></div>
                            <input type="text" id="answer-input" 
                                class="math-input-real w-full px-4 py-3 text-lg font-mono outline-none" 
                                placeholder="解答を入力..." 
                                oninput="updateMathInput(this.value)"
                                autocomplete="off">
                        </div>
                        <button onclick="submitCurrentAnswer()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold px-8 py-3 rounded-lg shadow-md transition transform active:scale-95 whitespace-nowrap">提 出</button>
                    </div>
                </div>
                
                <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                    <div class="flex gap-2 input-area">
                        <button class="bg-gray-100 hover:bg-gray-200 border border-gray-200 rounded px-4 py-2 font-mono text-gray-600 shrink-0" onclick="insertText('x')">x</button>
                        <button class="bg-gray-100 hover:bg-gray-200 border border-gray-200 rounded px-4 py-2 font-mono text-gray-600 shrink-0" onclick="insertText('y')">y</button>
                        <button class="bg-gray-100 hover:bg-gray-200 border border-gray-200 rounded px-4 py-2 font-mono text-gray-600 shrink-0" onclick="insertText('²')">²</button>
                        <button class="bg-gray-100 hover:bg-gray-200 border border-gray-200 rounded px-4 py-2 font-mono text-gray-600 shrink-0" onclick="insertText('√')">√</button>
                        <button class="bg-gray-100 hover:bg-gray-200 border border-gray-200 rounded px-4 py-2 font-mono text-gray-600 shrink-0" onclick="insertText('/')">/</button>
                        <button class="bg-gray-100 hover:bg-gray-200 border border-gray-200 rounded px-4 py-2 font-mono text-gray-600 shrink-0" onclick="insertText('(')">(</button>
                        <button class="bg-gray-100 hover:bg-gray-200 border border-gray-200 rounded px-4 py-2 font-mono text-gray-600 shrink-0" onclick="insertText(')')">)</button>
                    </div>
                    <div class="flex-1"></div>
                    <button class="text-gray-400 hover:text-gray-600 font-bold px-2" onclick="navQuestion(-1)">← PREV</button>
                    <button class="text-gray-400 hover:text-gray-600 font-bold px-2" onclick="navQuestion(1)">NEXT →</button>
                </div>
            </div>
        </div>
    </section>

    <section id="screen-finished" class="hidden-screen h-full flex flex-col bg-gray-50 overflow-y-auto">
        <div class="w-full max-w-2xl mx-auto p-6 my-10 bg-white rounded-xl shadow-sm">
            <div class="text-center border-b border-gray-100 pb-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">対戦終了</h2>
                <div class="flex justify-center my-4">
                    <div class="animate-pulse bg-blue-100 text-blue-600 px-4 py-1 rounded-full text-sm font-bold" id="user-status-msg">
                        集計中
                    </div>
                </div>
                <p class="text-gray-500 text-sm">しばらくお待ちください</p>
            </div>
            
            <div id="personal-result-area" class="hidden animate-fade-in">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-gray-800">おつかれさまでした</h2>
                </div>

                <div class="flex justify-between items-center mb-8 bg-gray-50 p-6 rounded-lg">
                    <div class="text-left">
                        <p class="text-xs text-gray-400 uppercase tracking-widest font-bold">あなたの順位</p>
                        <p class="text-4xl font-bold text-gray-900" id="my-rank-disp">-</p>
                    </div>
                    <div class="text-right flex flex-col items-end">
                        <p class="text-xs text-gray-400 uppercase tracking-widest font-bold">レート</p>
                        <p class="text-4xl font-mono font-bold text-blue-600 leading-none" id="my-rate-disp">-</p>
                        <p class="text-sm font-mono font-bold text-green-500 mt-1" id="my-rate-diff"></p>
                    </div>
                </div>
                <h3 class="text-sm font-bold text-gray-400 mb-4 tracking-widest">答え合わせ</h3>
                <div id="answer-review-list" class="space-y-4"></div>
                <div class="mt-8 pt-6 border-t border-gray-100">
                    <button onclick="backToLobby()" class="w-full bg-gray-900 text-white py-3 rounded-lg text-sm font-bold hover:bg-black transition">ロビーへ戻る</button>
                </div>
            </div>
        </div>
    </section>

    <section id="screen-admin" class="hidden-screen h-full flex bg-gray-50 text-gray-800 overflow-hidden">
        <div class="w-1/4 min-w-[320px] p-6 border-r border-gray-200 flex flex-col bg-white shadow-sm z-10 overflow-y-auto">
            <h1 class="text-2xl font-bold mb-1 tracking-tight text-gray-900">数学オンライン（仮）</h1>
            <p class="text-gray-400 tracking-wider text-xs mb-6">管理者ダッシュボード</p>

            <button id="btn-toggle-create" class="w-full bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold py-3 rounded-lg shadow-sm mb-4 transition flex justify-center items-center">
                <span class="mr-2 text-lg">＋</span> 新規イベント作成
            </button>

            <div id="create-event-form" class="hidden mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200 animate-fade-in">
                <div class="space-y-3">
                    <input type="text" id="new-evt-title" class="w-full text-sm p-2 border rounded" placeholder="イベント名">
                    <div>
                        <label class="text-xs text-gray-400">開始日時</label>
                        <input type="datetime-local" id="new-evt-time" class="w-full text-sm p-2 border rounded">
                    </div>
                    <div class="flex gap-2">
                        <div class="flex-1">
                            <label class="text-xs text-gray-400">制限時間(分)</label>
                            <input type="number" id="new-evt-duration" class="w-full text-sm p-2 border rounded" value="5">
                        </div>
                        <div class="flex-1">
                            <label class="text-xs text-gray-400">Min Rate</label>
                            <input type="number" id="new-evt-rate" class="w-full text-sm p-2 border rounded" value="0">
                        </div>
                    </div>
                    <button id="btn-create-event" class="w-full bg-gray-800 text-white text-xs py-2 rounded hover:bg-black">作成 (自動進行)</button>
                </div>
            </div>

            <p class="text-xs text-gray-400 uppercase mb-2">Event List</p>
            <div id="admin-event-list" class="space-y-2 flex-1 overflow-y-auto mb-4 min-h-[200px]"></div>
            
            <div class="mt-auto pt-4 border-t border-gray-100">
                <div class="flex justify-center items-center">
                    <img id="qr-code" src="" alt="QR Code" class="w-40 h-40 border border-gray-200 rounded">
                </div>
                <p class="text-[10px] text-gray-400 text-center mt-2">Scan to Join</p>
                <div class="hidden">
                    <button id="btn-stop-duel"></button>
                    <button id="btn-reveal"></button>
                </div>
            </div>
        </div>

        <div class="flex-1 p-6 bg-gray-50 overflow-hidden flex flex-col">
            <div class="flex items-center justify-between mb-4 border-b border-gray-200 pb-2">
                <div id="admin-status-header" class="text-2xl font-bold text-gray-800 flex items-center">
                    <span class="text-gray-400 text-sm">Select Event</span>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="flex bg-gray-200 rounded-lg p-0.5">
                        <button onclick="window.setGridSize('lg')" class="px-3 py-1 text-xs font-bold rounded-md hover:bg-white hover:shadow-sm transition">大</button>
                        <button onclick="window.setGridSize('md')" class="px-3 py-1 text-xs font-bold rounded-md hover:bg-white hover:shadow-sm transition">中</button>
                        <button onclick="window.setGridSize('sm')" class="px-3 py-1 text-xs font-bold rounded-md hover:bg-white hover:shadow-sm transition">小</button>
                    </div>
                    <div class="w-px h-4 bg-gray-300"></div>
                    <div class="flex items-center space-x-2">
                        <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                        <span class="text-xs text-gray-400">Live Updating</span>
                    </div>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto pt-4 px-2" id="admin-grid-container">
                <div id="admin-grid" class="grid gap-3 content-start"></div>
            </div>
        </div>
    </section>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCHNwaDa4L9tubLe2rKYOqqTsJVFbcgBFo",
            authDomain: "onlineroom-c08eb.firebaseapp.com",
            databaseURL: "https://onlineroom-c08eb-default-rtdb.firebaseio.com",
            projectId: "onlineroom-c08eb",
            storageBucket: "onlineroom-c08eb.firebasestorage.app",
            messagingSenderId: "1046314906343",
            appId: "1:1046314906343:web:43b4f23845e5171ac62842",
            measurementId: "G-6TRWQBMZKV"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const QUESTIONS = [
            { id: "q1", text: "x^2 - 4x + 3 = 0 \\text{ の解を求めよ。}", rule: "数値のみ, カンマ区切り", answer: ["1,3", "3,1", "x=1,3", "x=3,1"] },
            { id: "q2", text: "\\text{点}Q\\text{が放物線 } y=x^2-2x+4 \\text{ 上を動くとき、点}A(2,2)\\text{と点}Q\\text{を結ぶ線分}QA\\text{を} 3:2 \\text{ に外分する点}P\\text{の軌跡を求めよ。}", rule: "方程式のみ", answer: ["y=x^2-6x+13", "x^2-6x+13=y"] },
            { id: "q3", text: "\\int_{0}^{1} (3x^2 + 2x + 1) dx \\text{ を計算せよ。}", rule: "数値のみ", answer: ["3"] },
            { id: "q4", text: "\\text{三角形ABCにおいて、} a=3, b=4, C=60^\\circ \\text{のとき、} c \\text{の値を求めよ。}", rule: "数値またはルート", answer: ["\\sqrt{13}", "√13"] },
            { id: "q5", text: "\\sum_{k=1}^{n} k(k+1) \\text{ を } n \\text{を用いて表せ。}", rule: "nの式（展開不要）", answer: ["\\frac{1}{3}n(n+1)(n+2)", "1/3n(n+1)(n+2)", "n(n+1)(n+2)/3"] }
        ];

        let currentUser = null;
        let currentEventId = null;
        let currentEventEndTime = 0;
        let currentQIndex = 0;
        let userAnswers = ["", "", "", "", ""];
        let userProgress = [false, false, false, false, false];
        let isReviewMode = false;
        let adminGridSize = 'md';

        const ADMIN_NAME = "admin"; const ADMIN_PASS = "098545";

        const screens = {
            login: document.getElementById('screen-login'), lobby: document.getElementById('screen-lobby'),
            waiting: document.getElementById('screen-waiting'), answer: document.getElementById('screen-answer'),
            finished: document.getElementById('screen-finished'), admin: document.getElementById('screen-admin')
        };
        const loader = document.getElementById('loading-overlay');

        function showScreen(screenName) {
            Object.values(screens).forEach(el => el.classList.add('hidden-screen'));
            screens[screenName].classList.remove('hidden-screen');
            renderMathInElement(document.body, {delimiters: [{left: '\\[', right: '\\]', display: true}, {left: '$', right: '$', display: false}]});
        }

        document.getElementById('btn-login').addEventListener('click', async () => {
            const name = document.getElementById('input-username').value.trim();
            const pass = document.getElementById('input-passcode').value.trim();
            if (!name || !pass) return alert("入力してください");
            if (name === ADMIN_NAME && pass === ADMIN_PASS) { initAdminDashboard(); showScreen('admin'); return; }

            const userId = name + "_" + pass;
            const userRef = ref(db, 'users/' + userId);
            try {
                let snapshot = await get(userRef);
                if (!snapshot.exists()) {
                    currentUser = { uid: userId, name: name, passcode: pass, rate: 1000, createdAt: Date.now() };
                    await set(userRef, currentUser);
                } else { currentUser = snapshot.val(); }
                setupLobby(); showScreen('lobby');
            } catch (e) { alert("Login Error"); }
        });

        window.backToLobby = () => {
            if(!currentUser) return location.reload();
            setupLobby();
            showScreen('lobby');
        };

        function setupLobby() {
            document.getElementById('lobby-username').innerText = currentUser.name;
            document.getElementById('lobby-rate').innerText = Math.floor(currentUser.rate);
            
            // ★ Force Logout if deleted (Anti-Zombie)
            onValue(ref(db, `users/${currentUser.uid}`), (snap) => {
                if(!snap.exists()) {
                    alert("管理者により削除されました。");
                    location.reload();
                } else {
                    currentUser = snap.val();
                    document.getElementById('lobby-rate').innerText = Math.floor(currentUser.rate);
                }
            });

            onValue(ref(db, 'events'), (snap) => {
                const activeContainer = document.getElementById('event-list-active');
                const archiveContainer = document.getElementById('event-list-archive');
                activeContainer.innerHTML = "";
                archiveContainer.innerHTML = "";
                
                if (!snap.exists()) {
                    activeContainer.innerHTML = '<div class="text-center text-gray-400 text-sm py-4">現在募集中のイベントはありません。</div>';
                    return;
                }
                const events = snap.val();
                const sortedKeys = Object.keys(events).sort((a,b) => events[b].startTime - events[a].startTime);

                const activeKeys = [];
                const archiveKeys = [];

                sortedKeys.forEach(key => {
                    if(events[key].status === 'finished') archiveKeys.push(key);
                    else activeKeys.push(key);
                });

                if(activeKeys.length === 0) {
                    activeContainer.innerHTML = '<div class="text-center text-gray-400 text-sm py-4">現在募集中のイベントはありません。</div>';
                } else {
                    activeKeys.forEach(key => {
                        activeContainer.innerHTML += generateEventCardHTML(key, events[key], currentUser.rate, false);
                    });
                }

                const showCount = 5;
                archiveKeys.slice(0, showCount).forEach(key => {
                    archiveContainer.innerHTML += generateEventCardHTML(key, events[key], currentUser.rate, false);
                });
                
                const moreBtn = document.getElementById('btn-show-more-archive');
                if(archiveKeys.length > showCount) {
                    moreBtn.classList.remove('hidden');
                    moreBtn.onclick = () => {
                        archiveContainer.innerHTML = "";
                        archiveKeys.forEach(key => {
                            archiveContainer.innerHTML += generateEventCardHTML(key, events[key], currentUser.rate, false);
                        });
                        moreBtn.classList.add('hidden');
                    };
                } else {
                    moreBtn.classList.add('hidden');
                }
                
                updateCardTimers(events);
            });
        }

        setInterval(() => {
            const timerElements = document.querySelectorAll('.card-timer-active');
            timerElements.forEach(el => {
                const endTime = parseInt(el.dataset.endTime);
                const left = endTime - Date.now();
                if(left > 0) {
                    const m = Math.floor(left / 60000);
                    const s = Math.floor((left % 60000) / 1000);
                    el.innerText = `残り: ${m}:${String(s).padStart(2,'0')}`;
                } else {
                    el.innerText = "集計中";
                }
            });
        }, 1000);

        function updateCardTimers(events) {}

        function generateEventCardHTML(key, evt, userRate, isAdmin = false) {
            const minRate = evt.minRate || 0;
            const d = new Date(evt.startTime);
            const dateStr = `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
            const endTime = evt.startTime + (evt.duration * 60000);
            
            let btn = "";
            let cardBg = "bg-white border-gray-100";
            let timerHtml = "";

            if(isAdmin) {
                const isSelected = (key === currentEventId);
                cardBg = isSelected ? "bg-blue-50" : (evt.status === 'finished' ? "bg-gray-100" : "bg-white border-gray-200 hover:bg-gray-50 cursor-pointer");
                
                let statusText = "";
                let statusClass = "text-[10px] font-bold px-2 py-0.5 rounded ml-2 ";
                if (evt.status === 'waiting') { statusText = "予定"; statusClass += "bg-yellow-100 text-yellow-800"; }
                else if (evt.status === 'playing') { statusText = "進行中"; statusClass += "bg-blue-100 text-blue-800 animate-pulse"; }
                else if (evt.status === 'judging') { statusText = "集計中"; statusClass += "bg-purple-100 text-purple-800"; }
                else { statusText = "終了"; statusClass += "bg-gray-200 text-gray-500"; }

                if(evt.status === 'playing') {
                    timerHtml = `<span class="text-[10px] font-mono text-red-500 font-bold block text-right card-timer-active" data-end-time="${endTime}">--:--</span>`;
                }

                return `
                <div onclick="window.selectAdminEvent('${key}')" class="${cardBg} rounded-lg p-3 shadow-sm border transition mb-2">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="text-sm font-bold truncate w-32">${evt.title}</h4>
                            <div class="flex items-center mt-1">
                                <span class="text-[10px] font-mono text-gray-400">${dateStr}</span>
                            </div>
                        </div>
                        <div class="flex flex-col items-end">
                            <span class="${statusClass} mb-1">${statusText}</span>
                            ${timerHtml}
                        </div>
                    </div>
                </div>`;

            } else {
                const canJoin = userRate >= minRate;
                if (evt.status === "waiting") {
                    if (canJoin) {
                        btn = `<button onclick="window.joinEvent('${key}')" class="bg-white border-2 border-gray-900 text-gray-900 hover:bg-gray-900 hover:text-white font-bold py-2 px-4 rounded text-xs transition">参加待機</button>`;
                    } else {
                        btn = `<span class="text-xs text-red-400 font-bold">参加条件：レート${minRate}以上</span>`;
                    }
                } else if (evt.status === "playing") {
                    btn = `<button class="bg-gray-100 text-gray-400 font-bold py-2 px-4 rounded text-xs cursor-not-allowed">進行中</button>`;
                    timerHtml = `<span class="text-xs font-mono text-red-500 font-bold block mt-1 card-timer-active" data-end-time="${endTime}">--:--</span>`;
                } else if (evt.status === "finished") {
                    cardBg = "bg-gray-100 border-gray-200";
                    btn = `<button onclick="window.viewArchive('${key}')" class="bg-gray-200 text-gray-600 hover:bg-gray-300 font-bold py-2 px-4 rounded text-xs">過去問を見る</button>`;
                } else {
                    btn = `<button class="bg-gray-100 text-gray-400 font-bold py-2 px-4 rounded text-xs cursor-not-allowed">集計中</button>`;
                }

                return `
                <div class="${cardBg} rounded-lg p-4 shadow-sm border mb-3 flex justify-between items-center">
                    <div>
                        <div class="flex items-center space-x-2 mb-1">
                            <span class="bg-blue-100 text-blue-800 text-[10px] font-bold px-2 py-0.5 rounded">EVENT</span>
                            <span class="text-[10px] font-mono text-gray-400">${dateStr}</span>
                        </div>
                        <h4 class="text-base font-bold">${evt.title}</h4>
                        <div class="flex items-center mt-1">
                            ${timerHtml}
                        </div>
                    </div>
                    <div class="text-right">${btn}</div>
                </div>`;
            }
        }

        window.joinEvent = async (eventId) => {
            isReviewMode = false;
            currentEventId = eventId;
            const evtSnap = await get(ref(db, `events/${eventId}`));
            const evt = evtSnap.val();
            currentEventEndTime = evt.startTime + (evt.duration * 60 * 1000);
            await set(ref(db, `events/${eventId}/participants/${currentUser.uid}`), { name: currentUser.name, joinedAt: Date.now(), progress: [false,false,false,false,false] });
            showScreen('waiting');
            const timerEl = document.getElementById('countdown');
            const interval = setInterval(() => {
                const diff = evt.startTime - Date.now();
                if(diff <= 0) { timerEl.innerText = "00:00"; clearInterval(interval); } 
                else { const m = Math.floor(diff / 60000); const s = Math.floor((diff % 60000) / 1000); timerEl.innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
            }, 1000);
            onValue(ref(db, `events/${eventId}/status`), (snap) => {
                const s = snap.val();
                if (s === "playing") { 
                    initGame(); showScreen('answer'); 
                    document.getElementById('screen-answer').classList.remove('review-mode');
                    document.getElementById('review-badge').classList.add('hidden');
                    document.getElementById('btn-back-lobby-review').classList.add('hidden');
                    document.querySelectorAll('.input-area').forEach(e => e.style.display = 'flex');
                    document.getElementById('answer-timer-display').classList.remove('hidden');
                }
                if (s === "judging") { resetFinishedScreen(); showScreen('finished'); }
                if (s === "finished") { showPersonalResult(); } 
            });
        };

        window.viewArchive = (eventId) => {
            isReviewMode = true;
            currentQIndex = 0; userAnswers = ["","","","",""]; userProgress = [false,false,false,false,false];
            showScreen('answer');
            document.getElementById('screen-answer').classList.add('review-mode');
            document.getElementById('review-badge').classList.remove('hidden');
            document.getElementById('btn-back-lobby-review').classList.remove('hidden');
            document.getElementById('btn-back-lobby-review').onclick = window.backToLobby;
            document.getElementById('answer-timer-display').classList.add('hidden');
            document.querySelectorAll('.input-area').forEach(e => e.style.display = 'none');
            renderQuestion(); updateNavBubbles();
        };

        let answerTimer = null;
        function initGame() {
            currentQIndex = 0; userAnswers = ["","","","",""]; userProgress = [false,false,false,false,false];
            renderQuestion(); updateNavBubbles();
            if(answerTimer) clearInterval(answerTimer);
            const display = document.getElementById('answer-timer-display');
            answerTimer = setInterval(() => {
                const left = currentEventEndTime - Date.now();
                if(left <= 0) { display.innerText = "00:00"; clearInterval(answerTimer); } 
                else { const m = Math.floor(left/60000); const s = Math.floor((left%60000)/1000); display.innerText = `${m}:${String(s).padStart(2,'0')}`; }
            }, 1000);
        }

        function renderQuestion() {
            const q = QUESTIONS[currentQIndex];
            document.getElementById('display-q-num').innerText = currentQIndex + 1;
            const pel = document.getElementById('problem-text');
            pel.innerText = `\\[ ${q.text} \\]`;
            renderMathInElement(pel, {delimiters: [{left: '\\[', right: '\\]', display: true}]});
            document.getElementById('problem-rule').innerText = "※ " + q.rule;
            if(!isReviewMode) {
                const val = userAnswers[currentQIndex];
                document.getElementById('answer-input').value = val;
                window.updateMathInput(val);
            }
        }
        window.navQuestion = (diff) => {
            const next = currentQIndex + diff;
            if (next >= 0 && next < 5) { 
                if(!isReviewMode) userAnswers[currentQIndex] = document.getElementById('answer-input').value; 
                currentQIndex = next; renderQuestion(); updateNavBubbles(); 
            }
        };
        window.insertText = (t) => {
            const i = document.getElementById('answer-input');
            const s = i.selectionStart; i.value = i.value.slice(0,s) + t + i.value.slice(i.selectionEnd);
            i.focus(); i.selectionStart = i.selectionEnd = s + t.length; window.updateMathInput(i.value);
        };
        window.updateMathInput = (v) => {
            const overlay = document.getElementById('math-overlay');
            if(!v) { overlay.innerText = ""; return; }
            try { katex.render(v, overlay, { throwOnError: false }); } catch(e) { overlay.innerText = v; }
        };
        window.updateNavBubbles = () => {
            const c = document.getElementById('nav-bubbles'); c.innerHTML = "";
            for(let i=0; i<5; i++) {
                let cls = i === currentQIndex ? "border-2 border-blue-600 text-blue-600" : "border border-gray-300 text-gray-400";
                if(isReviewMode) cls = i === currentQIndex ? "border-2 border-gray-600 text-gray-600" : "border border-gray-300 text-gray-400";
                let dot = userProgress[i] ? `<span class="absolute top-0 right-0 block h-2.5 w-2.5 rounded-full ring-2 ring-white bg-green-500"></span>` : "";
                c.innerHTML += `<button class="w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm bg-white relative ${cls}" onclick="window.navQuestion(${i - currentQIndex})">${i+1}${dot}</button>`;
            }
        }
        window.submitCurrentAnswer = async () => {
            const val = document.getElementById('answer-input').value.trim();
            if (!val) return;
            userAnswers[currentQIndex] = val; userProgress[currentQIndex] = true;
            await set(ref(db, `events/${currentEventId}/participants/${currentUser.uid}/progress`), userProgress);
            await set(ref(db, `answers/${currentEventId}/${currentUser.uid}/q${currentQIndex+1}`), val);
            updateNavBubbles();
            if (userProgress.every(Boolean)) { 
                if(confirm("完了して待機画面に移動しますか？\n※待機画面からは戻ることができません。")) { 
                    resetFinishedScreen(); showScreen('finished'); 
                } 
            }
            else { const next = userProgress.findIndex((p,i)=>!p&&i>currentQIndex); window.navQuestion(next!==-1 ? next-currentQIndex : 1); }
        };

        function resetFinishedScreen() {
            document.getElementById('user-status-msg').innerText = "集計中";
            document.getElementById('user-status-msg').className = "animate-pulse bg-blue-100 text-blue-600 px-4 py-1 rounded-full text-sm font-bold";
            document.getElementById('personal-result-area').classList.add('hidden');
        }

        async function showPersonalResult() {
            showScreen('finished');
            document.getElementById('user-status-msg').innerText = "結果発表 / Results Released";
            document.getElementById('user-status-msg').className = "bg-green-100 text-green-700 px-4 py-1 rounded-full text-sm font-bold";
            const area = document.getElementById('personal-result-area');
            const list = document.getElementById('answer-review-list');
            
            const rankSnap = await get(ref(db, `events/${currentEventId}/ranking`));
            const ansSnap = await get(ref(db, `answers/${currentEventId}/${currentUser.uid}`));
            if(!rankSnap.exists()) return;
            const ranking = rankSnap.val();
            const myData = ranking.find(r => r.uid === currentUser.uid);
            const myAnswers = ansSnap.exists() ? ansSnap.val() : {};

            if(myData) {
                await update(ref(db, `users/${currentUser.uid}`), { rate: myData.newRate });
                document.getElementById('my-rank-disp').innerText = myData.rank + "位";
                document.getElementById('my-rate-disp').innerText = Math.floor(myData.newRate);
                const diff = myData.rateDiff > 0 ? `(+${myData.rateDiff})` : `(${myData.rateDiff})`;
                document.getElementById('my-rate-diff').innerText = diff;
                
                list.innerHTML = "";
                QUESTIONS.forEach((q, i) => {
                    const qKey = `q${i+1}`;
                    const myAns = myAnswers[qKey] || "(未回答)";
                    const isCorrect = myData.results[i]; 
                    const resultBadge = isCorrect 
                        ? `<span class="text-green-600 font-bold text-xs border border-green-200 bg-green-50 px-2 py-0.5 rounded">正解</span>`
                        : `<span class="text-red-500 font-bold text-xs border border-red-200 bg-red-50 px-2 py-0.5 rounded">不正解</span>`;
                    list.innerHTML += `
                    <div class="bg-white border border-gray-200 rounded-lg p-3">
                        <div class="flex justify-between items-center mb-2"><span class="text-xs font-mono text-gray-400">Q.${i+1}</span>${resultBadge}</div>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><p class="text-[10px] text-gray-400 uppercase">あなたの解答</p><p class="font-mono text-gray-800 break-all">\\(${myAns}\\)</p></div>
                            <div><p class="text-[10px] text-gray-400 uppercase">正解</p><p class="font-mono text-blue-600 break-all">\\(${q.answer[0]}\\)</p></div>
                        </div>
                    </div>`;
                });
                renderMathInElement(list, {delimiters: [{left: '\\(', right: '\\)', display: false}]});
                area.classList.remove('hidden');
            }
        }

        function initAdminDashboard() {
            const grid = document.getElementById('admin-grid');
            const formContainer = document.getElementById('create-event-form');
            const toggleBtn = document.getElementById('btn-toggle-create');
            const qrCode = document.getElementById('qr-code');
            const statusHeader = document.getElementById('admin-status-header');

            qrCode.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(window.location.href)}`;
            toggleBtn.onclick = () => {
                formContainer.classList.toggle('hidden');
                toggleBtn.innerText = formContainer.classList.contains('hidden') ? "＋ 新規イベント作成" : "× 閉じる";
            };
            
            document.getElementById('btn-create-event').onclick = async () => {
                const title = document.getElementById('new-evt-title').value;
                const timeStr = document.getElementById('new-evt-time').value;
                const duration = parseInt(document.getElementById('new-evt-duration').value) || 5;
                const rate = parseInt(document.getElementById('new-evt-rate').value) || 0;
                if(!title || !timeStr) return alert("入力エラー");
                const startTime = new Date(timeStr).getTime();
                const eventId = "evt_" + Math.floor(Date.now() / 1000);
                await set(ref(db, `events/${eventId}`), {
                    title: title, startTime: startTime, duration: duration, minRate: rate,
                    status: "waiting", participants: {}
                });
                alert("作成完了。");
                formContainer.classList.add('hidden');
                toggleBtn.innerText = "＋ 新規イベント作成";
            };

            onValue(ref(db, 'events'), (snap) => {
                const adminList = document.getElementById('admin-event-list');
                if(!snap.exists()) { adminList.innerHTML = ""; return; }
                const events = snap.val();
                const sortedKeys = Object.keys(events).sort((a,b) => events[b].startTime - events[a].startTime);
                if(!currentEventId && sortedKeys.length > 0) watchEvent(sortedKeys[0]);
                else if(currentEventId && !events[currentEventId]) {
                    if(sortedKeys.length > 0) watchEvent(sortedKeys[0]); else currentEventId = null;
                }
                adminList.innerHTML = "";
                sortedKeys.forEach(key => { adminList.innerHTML += generateEventCardHTML(key, events[key], -1, true); });
            });

            window.selectAdminEvent = (key) => {
                watchEvent(key);
                get(ref(db, 'events')).then(snap => {
                    if(snap.exists()) {
                        const events = snap.val();
                        const sortedKeys = Object.keys(events).sort((a,b) => events[b].startTime - events[a].startTime);
                        const adminList = document.getElementById('admin-event-list');
                        adminList.innerHTML = "";
                        sortedKeys.forEach(k => { adminList.innerHTML += generateEventCardHTML(k, events[k], -1, true); });
                    }
                });
            };

            window.setGridSize = (size) => {
                adminGridSize = size;
                const grid = document.getElementById('admin-grid');
                if(size === 'lg') grid.className = "grid grid-cols-2 gap-4 content-start pt-4 px-2";
                else if(size === 'md') grid.className = "grid grid-cols-3 md:grid-cols-4 gap-3 content-start pt-4 px-2";
                else grid.className = "grid grid-cols-4 md:grid-cols-6 gap-2 content-start pt-4 px-2";
                
                if(currentEventId) window.selectAdminEvent(currentEventId);
            }

            // ★ Kick Function (Enhanced & Fixed) ★
            window.kickUser = async (uid, name) => {
                if(!confirm(`ユーザー「${name}」を削除しますか？\n（イベントから強制退出させます）`)) return;
                if(!confirm(`本当に削除しますか？\nこの操作は取り消せません。\n※ユーザーデータも同時に削除されます。`)) return;

                // Visual removal immediately
                const card = document.getElementById(`grid-card-${uid}`);
                if(card) card.remove();

                const updates = {};
                // 1. Basic deletes
                updates[`events/${currentEventId}/participants/${uid}`] = null;
                updates[`answers/${currentEventId}/${uid}`] = null;
                updates[`users/${uid}`] = null;
                
                await update(ref(db), updates);

                // 2. Ranking clean-up (If game is finished/judged)
                const rankRef = ref(db, `events/${currentEventId}/ranking`);
                const rankSnap = await get(rankRef);
                if (rankSnap.exists()) {
                    const currentRanking = rankSnap.val();
                    const newRanking = currentRanking.filter(r => r.uid !== uid);
                    await set(rankRef, newRanking);
                }
            };

            let autoPilotTimer = null;
            let currentEventData = null; 

            function watchEvent(eventId) {
                currentEventId = eventId;
                grid.innerHTML = ""; 
                if(autoPilotTimer) clearInterval(autoPilotTimer);

                autoPilotTimer = setInterval(() => {
                    if(!currentEventData) return;
                    if(currentEventData.status === 'waiting' && Date.now() >= currentEventData.startTime) {
                        if(!currentEventData.participants || Object.keys(currentEventData.participants).length === 0) {
                            remove(ref(db, `events/${eventId}`)); return;
                        }
                        update(ref(db, `events/${eventId}`), {status: 'playing'});
                    }
                    if(currentEventData.status === 'playing') {
                        const endTime = currentEventData.startTime + (currentEventData.duration * 60 * 1000);
                        const left = endTime - Date.now();
                        if(left <= 0) stopAndJudge(eventId); 
                    }
                }, 1000);

                onValue(ref(db, `events/${eventId}`), (snap) => {
                    if(!snap.exists()) {
                        grid.innerHTML = '<p class="text-xs text-gray-400 p-2">Event deleted or not found.</p>';
                        statusHeader.innerHTML = `0<span class="text-sm font-sans font-normal text-gray-500 ml-1">人</span>`;
                        return;
                    }
                    const evt = snap.val();
                    currentEventData = evt; 
                    const pCount = evt.participants ? Object.keys(evt.participants).length : 0;
                    let statusText = "人 待機中";
                    if(evt.status === 'playing') statusText = "人 挑戦中";
                    if(evt.status === 'judging') statusText = "人 集計中";
                    if(evt.status === 'finished') statusText = "人 終了";
                    statusHeader.innerHTML = `${pCount}<span class="text-sm font-sans font-normal text-gray-500 ml-1">${statusText}</span>`;

                    const sizeClasses = {
                        'lg': { card: 'p-4', name: 'text-lg', sq: 'w-5 h-5' },
                        'md': { card: 'p-3', name: 'text-base', sq: 'w-3.5 h-3.5' },
                        'sm': { card: 'p-2', name: 'text-sm', sq: 'w-2.5 h-2.5' }
                    };
                    const s = sizeClasses[adminGridSize];

                    if(evt.ranking) {
                        const ranking = evt.ranking;
                        if(!document.querySelector('.reveal-row')) {
                            grid.innerHTML = "";
                            ranking.forEach(r => {
                                let squares = r.results.map(res => `<div class="${s.sq} rounded-sm ${res?'bg-correct':'bg-wrong'}"></div>`).join('');
                                // ★ ID Added for Kick Function
                                grid.innerHTML += `
                                <div id="grid-card-${r.uid}" onclick="window.kickUser('${r.uid}', '${r.name}')" class="${s.card} rounded bg-white border border-gray-100 shadow-sm flex flex-col justify-between gap-2 cursor-pointer hover:bg-red-50 hover:border-red-300 transition duration-200" title="クリックして削除">
                                    <div class="font-bold text-gray-700 truncate ${s.name}">${r.name}</div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-400 font-mono text-xs">#${r.rank}</span>
                                        <div class="flex space-x-0.5">${squares}</div>
                                    </div>
                                </div>`;
                            });
                        }
                    } else if(evt.participants) {
                        // ★ Object.entries for robust key handling
                        Object.entries(evt.participants).forEach(([uid, p]) => {
                            if(!document.getElementById(`grid-card-${uid}`)) {
                                let squares = (p.progress||[false,false,false,false,false]).map(d => `<div class="${s.sq} rounded-sm ${d?'bg-blue-600':'bg-gray-200'}"></div>`).join('');
                                // ★ ID Added for Kick Function
                                const html = `
                                <div id="grid-card-${uid}" onclick="window.kickUser('${uid}', '${p.name}')" class="${s.card} rounded bg-white border border-gray-100 shadow-sm flex flex-col justify-between gap-2 cursor-pointer hover:bg-red-50 hover:border-red-300 transition duration-200" title="クリックして削除">
                                    <div class="font-bold text-gray-700 truncate ${s.name}">${p.name}</div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-400 font-mono text-xs">READY</span>
                                        <div class="flex space-x-0.5">${squares}</div>
                                    </div>
                                </div>`;
                            }
                        });
                        // Re-render whole grid on update to ensure sync
                        grid.innerHTML = "";
                        Object.entries(evt.participants).forEach(([uid, p]) => {
                             let squares = (p.progress||[false,false,false,false,false]).map(d => `<div class="${s.sq} rounded-sm ${d?'bg-blue-600':'bg-gray-200'}"></div>`).join('');
                             grid.innerHTML += `
                                <div id="grid-card-${uid}" onclick="window.kickUser('${uid}', '${p.name}')" class="${s.card} rounded bg-white border border-gray-100 shadow-sm flex flex-col justify-between gap-2 cursor-pointer hover:bg-red-50 hover:border-red-300 transition duration-200" title="クリックして削除">
                                    <div class="font-bold text-gray-700 truncate ${s.name}">${p.name}</div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-400 font-mono text-xs">READY</span>
                                        <div class="flex space-x-0.5">${squares}</div>
                                    </div>
                                </div>`;
                        });
                    } else {
                        grid.innerHTML = '<p class="text-xs text-gray-300 p-4">No participants yet.</p>';
                    }
                });
            }

            async function stopAndJudge(eventId) {
                if(autoPilotTimer) clearInterval(autoPilotTimer);
                autoPilotTimer = null;
                await update(ref(db, `events/${eventId}`), {status:'judging'});
                const answers = (await get(ref(db, `answers/${eventId}`))).val() || {};
                const participants = (await get(ref(db, `events/${eventId}/participants`))).val() || {};
                const allUsers = (await get(ref(db, `users`))).val() || {};
                let userResults = [];
                let questionStats = [0,0,0,0,0];
                Object.keys(participants).forEach(uid => {
                    const p = participants[uid];
                    const uAnsObj = answers[uid] || {};
                    let correctCount = 0;
                    let results = [];
                    for(let i=0; i<5; i++) {
                        const uAns = (uAnsObj[`q${i+1}`] || "").replace(/\s+/g, '');
                        const valids = QUESTIONS[i].answer.map(a => a.replace(/\s+/g, ''));
                        const isCorrect = valids.includes(uAns);
                        results.push(isCorrect);
                        if(isCorrect) { correctCount++; questionStats[i]++; }
                    }
                    userResults.push({ uid, name: p.name, results, correctCount });
                });
                const total = userResults.length || 1;
                const BVs = questionStats.map(c => 100 - Math.floor((c/total)*100));
                userResults = userResults.map(u => {
                    let score = 0;
                    u.results.forEach((ok, i) => { if(ok) score += (BVs[i] + 50); });
                    u.score = score;
                    const curRate = (allUsers[u.uid] && allUsers[u.uid].rate) || 1000;
                    const diff = Math.floor(score * 0.1) + (u.correctCount * 10);
                    u.newRate = curRate + diff;
                    u.rateDiff = diff;
                    return u;
                });
                userResults.sort((a,b) => b.score - a.score);
                userResults.forEach((u,i) => u.rank = i+1);
                await set(ref(db, `events/${eventId}/ranking`), userResults);
                setTimeout(() => { startReveal(eventId); }, 10000);
            }

            async function startReveal(eventId) {
                const ranking = (await get(ref(db, `events/${eventId}/ranking`))).val();
                if(!ranking) return;
                
                window.setGridSize(adminGridSize);

                ranking.forEach(r => {
                    const s = { 'lg': {sq:'w-5 h-5'}, 'md': {sq:'w-3.5 h-3.5'}, 'sm': {sq:'w-2.5 h-2.5'} }[adminGridSize];
                    let squares = r.results.map(res => `<div class="${s.sq} rounded-sm bg-gray-200 transition-colors duration-500" data-res="${res}"></div>`).join('');
                });
                
                let i = ranking.length - 1;
                const interval = setInterval(() => {
                    if(i < 0) { clearInterval(interval); update(ref(db, `events/${eventId}`), {status:'finished'}); return; }
                    const user = ranking[i];
                    i--;
                }, 1200);
            }

            document.getElementById('btn-stop-duel').onclick = () => { if(confirm("強制終了しますか？")) stopAndJudge(currentEventId); };
            document.getElementById('btn-reveal').onclick = () => { if(confirm("強制発表しますか？")) startReveal(currentEventId); };
            
            window.setGridSize('md');
        }
    </script>
</body>
</html>